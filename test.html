<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CORS Proxy Preview Demo</title>
<style>
body { margin:0; font-family:sans-serif; background:#111; color:#eee; }
#bar { display:flex; padding:6px; background:#222; }
#url { flex:1; padding:6px; border:none; border-radius:4px; }
#go { margin-left:6px; padding:6px 12px; border:none; background:#4cafef; color:#fff; border-radius:4px; cursor:pointer; }
#status { padding:6px; background:#444; color:#fff; font-size:0.9em; text-align:center; }
#viewer { width:100%; height:calc(100vh - 42px); border:none; background:#222; overflow:auto; padding:10px; }
pre { white-space: pre-wrap; word-wrap: break-word; color:#0f0; }
</style>
</head>
<body>
<div id="bar">
<input id="url" type="text" placeholder="https://example.com">
<button id="go">Go</button>
</div>
<div id="status">Enter a URL and click Go or press Enter.</div>
<div id="viewer">
Enter a URL above and click Go or press Enter.
</div>

<script>
const urlBox = document.getElementById("url");
const goBtn = document.getElementById("go");
const statusDiv = document.getElementById("status");
const viewer = document.getElementById("viewer");
const CORS_PROXY = "https://cors-anywhere.herokuapp.com/";

// Fetch the site and display raw HTML or open in new tab
async function loadSite(url, openInNewTab=false) {
    if (!url.startsWith("http")) url = "https://" + url;
    statusDiv.textContent = "Fetching site via proxy...";

    try {
        const response = await fetch(CORS_PROXY + url);
        const html = await response.text();

        if (openInNewTab) {
            // Open in new tab (may still break scripts)
            const newTab = window.open("", "_blank");
            if (!newTab) {
                alert("Popup blocked! Allow popups for this site.");
                return;
            }
            newTab.document.open();
            newTab.document.write(html);
            newTab.document.close();
            statusDiv.textContent = "Site opened in new tab (proxied)";
        } else {
            // Show raw HTML in viewer
            viewer.innerHTML = `<pre>${html.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</pre>`;
            statusDiv.textContent = "Site loaded (raw HTML preview)";
        }
    } catch(e) {
        statusDiv.textContent = "Failed to load site: " + e;
        viewer.innerHTML = `<p style="color:red;">Failed to load site: ${e}</p>`;
    }
}

// Go button click
goBtn.addEventListener("click", () => {
    const target = urlBox.value.trim();
    if (!target) return alert("Enter a URL");
    // Change second argument to true if you want new tab instead of preview
    loadSite(target, false);
});

// Enter key triggers Go
urlBox.addEventListener("keydown", e => {
    if(e.key === "Enter") {
        e.preventDefault();
        goBtn.click();
    }
});
</script>
</body>
</html>
