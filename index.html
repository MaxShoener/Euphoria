<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CORS Proxy New Tab</title>
<style>
body { margin:0; font-family:sans-serif; background:#111; color:#eee; }
#bar { display:flex; padding:6px; background:#222; }
#url { flex:1; padding:6px; border:none; border-radius:4px; }
#go { margin-left:6px; padding:6px 12px; border:none; background:#4cafef; color:#fff; border-radius:4px; cursor:pointer; }
#status { padding:6px; background:#444; color:#fff; font-size:0.9em; text-align:center; }
</style>
</head>
<body>
<div id="bar">
<input id="url" type="text" placeholder="https://example.com">
<button id="go">Go</button>
</div>
<div id="status">Enter a URL and click Go or press Enter.</div>

<script>
const urlBox = document.getElementById("url");
const goBtn = document.getElementById("go");
const statusDiv = document.getElementById("status");
const CORS_PROXY = "https://cors-anywhere.herokuapp.com/";

// Helper: rewrite relative URLs in HTML to go through proxy
function rewriteUrls(html, baseUrl) {
    return html.replace(
        /(src|href)=["']([^"':]+)["']/gi,
        (match, attr, url) => {
            try {
                const absoluteUrl = new URL(url, baseUrl).href;
                return `${attr}="${CORS_PROXY}${absoluteUrl}"`;
            } catch(e) {
                return match; // leave as is if invalid URL
            }
        }
    );
}

// Load the site via proxy and open in new tab
async function loadSite(url) {
    if (!url.startsWith("http")) url = "https://" + url;
    statusDiv.textContent = "Fetching site via proxy...";
    const proxyUrl = CORS_PROXY + url;

    try {
        const response = await fetch(proxyUrl);
        const html = await response.text();
        const rewrittenHtml = rewriteUrls(html, url);
        const blob = new Blob([rewrittenHtml], {type: 'text/html'});
        const blobUrl = URL.createObjectURL(blob);
        window.open(blobUrl, '_blank');
        statusDiv.textContent = "Site opened in new tab (proxied)";
    } catch(e) {
        statusDiv.textContent = "Failed to load site: " + e;
    }
}

// Event listeners
goBtn.addEventListener("click", () => {
    const target = urlBox.value.trim();
    if (!target) return alert("Enter a URL");
    loadSite(target);
});

urlBox.addEventListener("keydown", e => {
    if(e.key === "Enter") {
        e.preventDefault();
        goBtn.click();
    }
});
</script>
</body>
</html>
