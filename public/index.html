<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Euphoria</title>
<style>
  html, body { margin:0; padding:0; height:100%; font-family:sans-serif; background:#111; color:#fff; display:flex; flex-direction:column; }
  
  /* Top bar */
  #topbar { display:flex; align-items:center; gap:0.3rem; padding:0.3rem; background:rgba(30,30,40,0.9); transition:0.3s; }
  #topbar.hidden { display:none; }

  /* Buttons same size */
  button { flex:0 0 40px; height:40px; border:none; border-radius:6px; background:#4cafef; color:white; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:600; transition:0.2s; }
  button:hover { background:#3690d9; }

  /* Input field */
  input { flex:1; padding:0.5rem; border-radius:6px; border:none; background:#3e3e50; color:#fff; font-size:1rem; }
  input:focus { outline:none; box-shadow:0 0 5px #4cafef; }

  /* Browser area */
  #browser { flex:1; overflow:auto; position:relative; background:#fff; color:#000; }
  #browser * { max-width:100%; word-wrap:break-word; }

</style>
</head>
<body>

<header id="topbar">
  <button title="Fullscreen" onclick="toggleFullscreen()">‚õ∂</button>
  <button title="Back" onclick="goBack()">‚óÄ</button>
  <button title="Forward" onclick="goForward()">‚ñ∂</button>
  <button title="Refresh" onclick="refreshPage()">‚ü≥</button>
  <button title="Home" onclick="goHome()">üè†</button>
  <input id="url" type="text" placeholder="Enter URL or search term" onkeypress="handleEnter(event)">
  <button title="Go" onclick="navigate()">Go</button>
</header>

<div id="browser">Welcome to Euphoria!</div>

<script>
const browser = document.getElementById("browser");
const urlInput = document.getElementById("url");
const topbar = document.getElementById("topbar");
let historyStack = [];
let historyIndex = -1;
let fullscreen = false;

// Fullscreen toggle
function toggleFullscreen() {
    fullscreen = !fullscreen;
    topbar.classList.toggle('hidden', fullscreen);
}
document.addEventListener('keydown', e => { 
    if(e.key === "Escape" && fullscreen) toggleFullscreen(); 
});

// Normalize URL or Google search
function normalizeURL(input) {
    input = input.trim();
    if(!input) return "https://www.google.com";
    if(!/^https?:\/\//i.test(input)) {
        if(input.includes(".")) return "https://" + input;
        return `https://www.google.com/search?q=${encodeURIComponent(input)}`;
    }
    return input;
}

// Navigation
async function navigate() {
    let url = normalizeURL(urlInput.value);

    // History management
    if(historyIndex === -1 || historyStack[historyIndex] !== url) {
        historyStack = historyStack.slice(0, historyIndex + 1);
        historyStack.push(url);
        historyIndex++;
    }

    urlInput.value = url;
    browser.textContent = "Loading‚Ä¶";

    try {
        const res = await fetch(`/proxy?url=${encodeURIComponent(url)}`);
        const html = await res.text();
        browser.innerHTML = html;

        // Rewrite all links to use proxy
        browser.querySelectorAll("a").forEach(a => {
            const href = a.getAttribute("href");
            if(href && !href.startsWith("javascript:")) {
                a.addEventListener("click", e => {
                    e.preventDefault();
                    urlInput.value = new URL(href, url).href;
                    navigate();
                });
            }
        });

        // Rewrite all forms to submit through proxy
        browser.querySelectorAll("form").forEach(form => {
            form.addEventListener("submit", e => {
                e.preventDefault();
                const action = form.action || url;
                const formData = new FormData(form);
                const query = new URLSearchParams(formData).toString();
                urlInput.value = action.includes("?") ? `${action}&${query}` : `${action}?${query}`;
                navigate();
            });
        });
    } catch(err) {
        browser.textContent = "Error loading page: " + err.message;
    }
}

// Navigation buttons
function goBack() { if(historyIndex>0){ historyIndex--; urlInput.value=historyStack[historyIndex]; navigate(); } }
function goForward() { if(historyIndex<historyStack.length-1){ historyIndex++; urlInput.value=historyStack[historyIndex]; navigate(); } }
function refreshPage() { if(historyIndex>=0) navigate(); }
function goHome() { urlInput.value="https://www.google.com"; navigate(); }
function handleEnter(e) { if(e.key==="Enter") navigate(); }

</script>

</body>
</html>
