<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Euphoria</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#0b0e14;
      --panel:rgba(255,255,255,.07);
      --panel2:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.65);
      --stroke:rgba(255,255,255,.14);
      --shadow: 0 12px 36px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 999px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --accent: rgba(120,170,255,.95);
      --accent2: rgba(120,255,210,.90);
      --danger: rgba(255,120,120,.90);
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f7f8fb;
        --panel:rgba(0,0,0,.05);
        --panel2:rgba(0,0,0,.075);
        --text:rgba(0,0,0,.88);
        --muted:rgba(0,0,0,.60);
        --stroke:rgba(0,0,0,.14);
        --shadow: 0 12px 36px rgba(0,0,0,.12);
      }
    }
    [data-theme="dark"]{
      --bg:#0b0e14;
      --panel:rgba(255,255,255,.07);
      --panel2:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.65);
      --stroke:rgba(255,255,255,.14);
      --shadow: 0 12px 36px rgba(0,0,0,.35);
    }
    [data-theme="light"]{
      --bg:#f7f8fb;
      --panel:rgba(0,0,0,.05);
      --panel2:rgba(0,0,0,.075);
      --text:rgba(0,0,0,.88);
      --muted:rgba(0,0,0,.60);
      --stroke:rgba(0,0,0,.14);
      --shadow: 0 12px 36px rgba(0,0,0,.12);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 20% 0%, rgba(120,170,255,.18), transparent 60%),
                  radial-gradient(1200px 700px at 80% 0%, rgba(120,255,210,.12), transparent 60%),
                  var(--bg);
      color:var(--text);
      font-family:var(--sans);
      overflow:hidden;
    }

    .app{
      height:100%;
      display:flex;
      flex-direction:column;
    }

    /* translucent top oval */
    .topbar-wrap{
      position:sticky;
      top:0;
      z-index:50;
      padding:14px 14px 10px;
      display:flex;
      justify-content:center;
    }
    .topbar{
      width:min(1120px, calc(100% - 0px));
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      border-radius: var(--radius2);
      padding:10px 10px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .btn{
      height:38px;
      min-width:38px;
      border-radius: 12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--text);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
    }
    .btn:hover{ background: rgba(255,255,255,.10); }
    .btn:active{ transform: translateY(1px); }
    .btn[disabled]{ opacity:.45; cursor:not-allowed; }
    .btn svg{ width:18px; height:18px; opacity:.9; }

    .addr{
      flex:1;
      height:38px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.10);
      color:var(--text);
      padding:0 12px;
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 140px;
    }
    .addr input{
      flex:1;
      height:100%;
      border:none;
      outline:none;
      background:transparent;
      color:var(--text);
      font-size:14px;
    }
    .addr .hint{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:240px;
    }

    .chip{
      height:38px;
      padding:0 12px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      user-select:none;
    }
    .chip:hover{ background: rgba(255,255,255,.10); }
    .chip .dot{
      width:8px; height:8px; border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(120,170,255,.15);
    }
    .chip .label{
      font-size:13px;
      color:var(--text);
      opacity:.92;
    }
    .chip .sub{
      font-size:12px;
      color:var(--muted);
      font-family:var(--mono);
    }

    .main{
      height:100%;
      display:flex;
      justify-content:center;
      padding: 0 14px 14px;
    }
    .frame{
      width:min(1120px, 100%);
      height: calc(100vh - 86px);
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.10);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      position:relative;
    }

    /* We avoid iframes; instead open proxied page in same tab (this UI is for navigating + settings). */
    .home{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .card{
      width:min(860px, 100%);
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
    }
    .row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .title{
      font-size:15px;
      font-weight:650;
      letter-spacing:.2px;
    }
    .muted{
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
    }
    .hr{
      height:1px;
      background: var(--stroke);
      margin:14px 0;
    }

    .field{
      display:flex;
      align-items:center;
      gap:10px;
      width:100%;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.10);
      border-radius: 14px;
      padding:10px 12px;
    }
    .field input{
      border:none;
      outline:none;
      background:transparent;
      color:var(--text);
      width:100%;
      font-size:14px;
      font-family:var(--mono);
    }
    .field small{ color:var(--muted); }

    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      border-radius: 14px;
      cursor:pointer;
      user-select:none;
    }
    .toggle:hover{ background: rgba(255,255,255,.10); }
    .switch{
      width:44px; height:26px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.15);
      position:relative;
      flex:0 0 auto;
    }
    .switch::after{
      content:"";
      width:20px; height:20px;
      border-radius:999px;
      background: rgba(255,255,255,.85);
      position:absolute;
      top:50%;
      left:3px;
      transform: translateY(-50%);
      transition: left .15s ease;
    }
    .toggle[data-on="true"] .switch{
      background: rgba(120,170,255,.22);
      border-color: rgba(120,170,255,.40);
    }
    .toggle[data-on="true"] .switch::after{ left:21px; }
    .toggle .tlabel{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .toggle .tlabel b{ font-size:13px; font-weight:650; }
    .toggle .tlabel span{ font-size:12px; color:var(--muted); }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .primary{
      border-color: rgba(120,170,255,.40);
      background: rgba(120,170,255,.18);
    }
    .primary:hover{ background: rgba(120,170,255,.24); }
    .danger{
      border-color: rgba(255,120,120,.40);
      background: rgba(255,120,120,.14);
    }
    .danger:hover{ background: rgba(255,120,120,.20); }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      font-family: var(--mono);
      font-size:12px;
      color:var(--muted);
    }

    .footer{
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .toast{
      position:absolute;
      left:50%;
      bottom:14px;
      transform: translateX(-50%);
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.40);
      backdrop-filter: blur(10px);
      color:var(--text);
      font-size:13px;
      display:none;
      max-width: calc(100% - 28px);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .toast.show{ display:block; }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="topbar-wrap">
      <div class="topbar">
        <button class="btn" id="btnBack" title="Back">
          <svg viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button class="btn" id="btnFwd" title="Forward">
          <svg viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button class="btn" id="btnReload" title="Reload">
          <svg viewBox="0 0 24 24" fill="none"><path d="M21 12a9 9 0 1 1-2.64-6.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M21 3v6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>

        <div class="addr">
          <input id="address" spellcheck="false" autocomplete="off" placeholder="Search or enter URL" />
          <div class="hint" id="modeHint">mode: basic</div>
        </div>

        <button class="btn primary" id="btnGo" title="Go">
          <svg viewBox="0 0 24 24" fill="none"><path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M13 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>

        <div class="chip" id="btnHome" title="Home / Settings">
          <div class="dot"></div>
          <div class="label">Home</div>
          <div class="sub" id="originMini"></div>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="frame">
        <div class="home" id="home">
          <div class="card">
            <div class="row">
              <div>
                <div class="title">Euphoria</div>
                <div class="muted">Minimal controls. Type a URL or search terms in the bar above.</div>
              </div>
              <div class="pill" id="buildInfo">/proxy + optional /sj</div>
            </div>

            <div class="hr"></div>

            <div class="row" style="gap:10px;">
              <div style="flex:1; min-width:260px;">
                <div class="muted" style="margin-bottom:8px;">Optional Wisp/Scramjet endpoint (if you use one).</div>
                <div class="field">
                  <input id="wispUrl" placeholder="https://your-wisp.example (optional)" />
                </div>
              </div>

              <div style="flex:1; min-width:260px;">
                <div class="muted" style="margin-bottom:8px;">Import / Export session bundle.</div>
                <div class="actions" style="justify-content:flex-start;">
                  <button class="btn" id="btnExport">Export</button>
                  <button class="btn" id="btnImport">Import</button>
                  <button class="btn danger" id="btnClear">Clear</button>
                </div>
              </div>
            </div>

            <div class="hr"></div>

            <div class="row">
              <div class="toggle" id="tScramjet" data-on="false">
                <div class="switch"></div>
                <div class="tlabel">
                  <b>Prefer Scramjet</b>
                  <span>Uses /sj when available, else falls back.</span>
                </div>
              </div>

              <div class="toggle" id="tDark" data-on="false">
                <div class="switch"></div>
                <div class="tlabel">
                  <b>Theme</b>
                  <span>Toggle dark / light.</span>
                </div>
              </div>

              <div class="toggle" id="tCookies" data-on="true">
                <div class="switch"></div>
                <div class="tlabel">
                  <b>Strict cookie jar</b>
                  <span>Per-origin cookies for safer logins.</span>
                </div>
              </div>
            </div>

            <div class="footer">
              <div class="muted" id="status">Ready.</div>
              <div class="actions">
                <button class="btn primary" id="btnApply">Apply</button>
              </div>
            </div>
          </div>
        </div>

        <div class="toast" id="toast"></div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const $ = (id)=>document.getElementById(id);

      const address = $("address");
      const btnGo = $("btnGo");
      const btnHome = $("btnHome");
      const btnBack = $("btnBack");
      const btnFwd = $("btnFwd");
      const btnReload = $("btnReload");
      const home = $("home");
      const toast = $("toast");
      const modeHint = $("modeHint");
      const originMini = $("originMini");
      const wispUrl = $("wispUrl");
      const tScramjet = $("tScramjet");
      const tDark = $("tDark");
      const tCookies = $("tCookies");
      const btnApply = $("btnApply");
      const btnExport = $("btnExport");
      const btnImport = $("btnImport");
      const btnClear = $("btnClear");
      const status = $("status");

      function publicOrigin(){
        return location.origin;
      }
      originMini.textContent = publicOrigin().replace(/^https?:\/\//,'');
      function showToast(msg){
        toast.textContent = msg;
        toast.classList.add("show");
        clearTimeout(showToast._t);
        showToast._t = setTimeout(()=>toast.classList.remove("show"), 1600);
      }

      const STORE_KEY = "euphoria_ui_state_v1";
      function loadState(){
        try { return JSON.parse(localStorage.getItem(STORE_KEY) || "{}"); } catch { return {}; }
      }
      function saveState(s){
        localStorage.setItem(STORE_KEY, JSON.stringify(s));
      }

      function setToggle(el, on){
        el.dataset.on = on ? "true" : "false";
      }
      function getToggle(el){
        return el.dataset.on === "true";
      }

      function applyTheme(){
        const s = loadState();
        const theme = s.theme || "auto";
        if(theme === "dark") document.documentElement.dataset.theme = "dark";
        else if(theme === "light") document.documentElement.dataset.theme = "light";
        else delete document.documentElement.dataset.theme;
      }

      function updateModeHint(){
        const s = loadState();
        modeHint.textContent = "mode: " + (s.preferScramjet ? "scramjet" : "basic");
      }

      function setHomeVisible(v){
        home.style.display = v ? "flex" : "none";
      }

      function normalizeInputToProxyUrl(input){
        const raw = (input || "").trim();
        if(!raw) return null;

        const s = loadState();
        const preferSj = !!s.preferScramjet;

        const isUrlish = /^https?:\/\//i.test(raw) || /^[a-z0-9.-]+\.[a-z]{2,}([/].*)?$/i.test(raw);
        const target = isUrlish ? (raw.startsWith("http") ? raw : "https://" + raw) : null;

        // If not urlish, send as Google search through backend:
        if(!target){
          const base = preferSj ? "/sj" : "/proxy";
          return publicOrigin() + base + "?q=" + encodeURIComponent(raw);
        }

        // Urlish
        const base = preferSj ? "/sj" : "/proxy";
        return publicOrigin() + base + "?url=" + encodeURIComponent(target);
      }

      function go(){
        const u = normalizeInputToProxyUrl(address.value);
        if(!u){ showToast("Enter a URL or search"); return; }
        setHomeVisible(false);
        showToast("Loadingâ€¦");
        location.href = u;
      }

      function hydrate(){
        const s = loadState();

        wispUrl.value = s.wispServer || "";
        setToggle(tScramjet, !!s.preferScramjet);
        setToggle(tCookies, s.strictCookies !== false);
        setToggle(tDark, (s.theme || "auto") === "dark");

        applyTheme();
        updateModeHint();
      }

      function apply(){
        const s = loadState();
        s.wispServer = (wispUrl.value || "").trim();
        s.preferScramjet = getToggle(tScramjet);
        s.strictCookies = getToggle(tCookies);
        s.theme = getToggle(tDark) ? "dark" : "auto";
        saveState(s);

        applyTheme();
        updateModeHint();

        status.textContent = "Saved.";
        showToast("Saved");
      }

      tScramjet.addEventListener("click", ()=>setToggle(tScramjet, !getToggle(tScramjet)));
      tDark.addEventListener("click", ()=>setToggle(tDark, !getToggle(tDark)));
      tCookies.addEventListener("click", ()=>setToggle(tCookies, !getToggle(tCookies)));

      btnApply.addEventListener("click", apply);

      btnGo.addEventListener("click", go);
      address.addEventListener("keydown", (e)=>{ if(e.key === "Enter") go(); });

      btnHome.addEventListener("click", ()=>{
        setHomeVisible(true);
        status.textContent = "Ready.";
      });

      btnBack.addEventListener("click", ()=>history.back());
      btnFwd.addEventListener("click", ()=>history.forward());
      btnReload.addEventListener("click", ()=>location.reload());

      btnExport.addEventListener("click", async ()=>{
        try{
          const s = loadState();
          const blob = new Blob([JSON.stringify(s, null, 2)], {type:"application/json"});
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = "euphoria-session.json";
          a.click();
          setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
          showToast("Exported");
        }catch(e){
          showToast("Export failed");
        }
      });

      btnImport.addEventListener("click", ()=>{
        const inp = document.createElement("input");
        inp.type = "file";
        inp.accept = "application/json";
        inp.onchange = async ()=>{
          const f = inp.files && inp.files[0];
          if(!f) return;
          try{
            const txt = await f.text();
            const obj = JSON.parse(txt);
            saveState(obj || {});
            hydrate();
            showToast("Imported");
          }catch(e){
            showToast("Import failed");
          }
        };
        inp.click();
      });

      btnClear.addEventListener("click", ()=>{
        localStorage.removeItem(STORE_KEY);
        hydrate();
        showToast("Cleared");
      });

      // Home screen only if we're at /
      if(location.pathname === "/" || location.pathname === "/index.html"){
        setHomeVisible(true);
      }else{
        setHomeVisible(false);
      }

      hydrate();
    })();
  </script>
</body>
</html>