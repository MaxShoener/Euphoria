<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Euphoria Web Proxy</title>
<style>
body { margin:0; font-family: 'Segoe UI', sans-serif; background:#121212; color:#f0f0f0; }
a { color:#1e90ff; word-break: break-word; transition: color 0.2s; }
a:hover { color:#63b3ed; }

/* Top bar */
.top-bar {
    display:flex; align-items:center; justify-content:space-between;
    background:#1f1f1f; height:42px; padding:4px 10px;
    border-radius:20px 20px 0 0; box-shadow:0 2px 4px rgba(0,0,0,0.5);
}
.nav-left { display:flex; align-items:center; }
#logo { width:32px; height:32px; border-radius:50%; margin-right:8px; box-shadow:0 0 4px rgba(0,0,0,0.5); transition: transform 0.2s; }
#logo:hover { transform:scale(1.1); }
.nav-buttons button, #goBtn {
    margin:0 3px; padding:4px 8px; font-size:12px;
    border-radius:10px; border:none; background:#2e2e2e; color:#fff; cursor:pointer; transition:all 0.2s;
}
button:hover,#goBtn:hover { background:#3e3e3e; transform:translateY(-1px); box-shadow:0 1px 3px rgba(0,0,0,0.4); }
#urlInput { flex:1; margin:0 6px; padding:4px 8px; border-radius:10px; border:none; font-size:13px; background:#2b2b2b; color:#fff; transition:background 0.2s,box-shadow 0.2s; }
#urlInput:focus { outline:none; background:#3b3b3b; box-shadow:0 0 6px rgba(30,144,255,0.8); }
#status { font-size:13px; color:#aaa; margin-left:6px; }

/* Progress bar */
#progress-bar-container { position:sticky; top:42px; width:100%; height:3px; background:#2e2e2e; z-index:999; }
#progress-bar { width:0%; height:100%; background:#1e90ff; transition: width 0.3s; }

/* Spinner */
#spinner { display:none; position:fixed; top:50%; left:50%; width:40px; height:40px; margin:-20px 0 0 -20px; border:4px solid #2e2e2e; border-top:4px solid #1e90ff; border-radius:50%; animation:spin 1s linear infinite; z-index:1001; }
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

/* Content */
#content { margin:10px; min-height:75vh; background:#121212; border-radius:10px; padding:10px; box-shadow:0 1px 3px rgba(0,0,0,0.4); }
#content a { transition:color 0.2s; }
#content a:hover { color:#63b3ed; }

/* Scrollbar */
::-webkit-scrollbar { width:8px; }
::-webkit-scrollbar-track { background:#1f1f1f; border-radius:4px; }
::-webkit-scrollbar-thumb { background:#555; border-radius:4px; }
::-webkit-scrollbar-thumb:hover { background:#777; }
</style>
</head>
<body>

<div class="top-bar">
    <div class="nav-left">
        <img src="logo.png" alt="Euphoria Logo" id="logo">
        <div class="nav-buttons">
            <button id="backBtn">‚óÄ Back</button>
            <button id="forwardBtn">‚ñ∂ Forward</button>
            <button id="reloadBtn">‚ü≥ Reload</button>
            <button id="homeBtn">üè† Home</button>
        </div>
    </div>
    <input type="text" id="urlInput" placeholder="Enter URL">
    <button id="goBtn">Go</button>
    <span id="status">Idle</span>
</div>

<div id="progress-bar-container"><div id="progress-bar"></div></div>
<div id="spinner"></div>
<div id="content">Proxied page content will appear here.</div>

<script>
const content=document.getElementById('content');
const urlInput=document.getElementById('urlInput');
const status=document.getElementById('status');
const progressBar=document.getElementById('progress-bar');
const spinner=document.getElementById('spinner');

const historyStack=[];
let currentIndex=-1;

function setProgress(p){ progressBar.style.width=p+'%'; }
function showSpinner(b){ spinner.style.display=b?'block':'none'; }

async function loadUrl(url, addHistory=true){
    try{
        status.textContent='Loading...';
        setProgress(10); showSpinner(true);
        const res=await fetch(`/proxy?url=${encodeURIComponent(url)}`);
        setProgress(50);
        const html=await res.text();
        content.innerHTML=html;

        const parser=new DOMParser();
        const doc=parser.parseFromString(html,'text/html');
        document.title=doc.title?`Euphoria - ${doc.title}`:'Euphoria';

        content.querySelectorAll('a').forEach(a=>{
            const href=a.getAttribute('href');
            if(href && !href.startsWith('/proxy')){
                a.setAttribute('href', `/proxy?url=${encodeURIComponent(new URL(href,url).href)}`);
                a.addEventListener('click',e=>{e.preventDefault(); loadUrl(new URL(href,url).href);});
            }
        });

        urlInput.value=url;
        setProgress(100); status.textContent='Loaded'; showSpinner(false);
        if(addHistory){ historyStack.splice(currentIndex+1); historyStack.push(url); currentIndex++; }
        setTimeout(()=>setProgress(0),300);
    }catch(err){ content.innerHTML=`Error loading page: ${err.message}`; status.textContent='Error'; setProgress(0); showSpinner(false); }
}

document.getElementById('backBtn').addEventListener('click',()=>{ if(currentIndex>0){ currentIndex--; loadUrl(historyStack[currentIndex],false); }});
document.getElementById('forwardBtn').addEventListener('click',()=>{ if(currentIndex<historyStack.length-1){ currentIndex++; loadUrl(historyStack[currentIndex],false); }});
document.getElementById('reloadBtn').addEventListener('click',()=>{ if(currentIndex>=0) loadUrl(historyStack[currentIndex],false); });
document.getElementById('homeBtn').addEventListener('click',()=>loadUrl('https://www.google.com',true));
document.getElementById('goBtn').addEventListener('click',()=>{ const url=urlInput.value;if(url) loadUrl(url,true); });

const ws=new WebSocket(`wss://${location.host}`);
ws.onmessage=e=>console.log('WS:',e.data);

loadUrl('https://www.google.com',true);
</script>

</body>
</html>