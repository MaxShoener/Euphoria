<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Euphoria Mini Browser</title>
<style>
  html, body { margin:0; padding:0; height:100%; font-family:sans-serif; background:#111; color:#fff; display:flex; flex-direction:column; }
  #topbar { display:flex; align-items:center; gap:0.3rem; padding:0.5rem; background:rgba(30,30,40,0.9); transition:0.3s; }
  #topbar.hidden { display:none; }

  /* Buttons all same size */
  button { flex:0 0 40px; height:40px; border:none; border-radius:6px; background:#4cafef; color:white; cursor:pointer; transition:0.2s; font-weight:600; display:flex; align-items:center; justify-content:center; }
  button:hover { background:#3690d9; }

  /* Input field */
  input { flex:1; padding:0.5rem; border-radius:6px; border:none; background:#3e3e50; color:#fff; font-size:1rem; }
  input:focus { outline:none; box-shadow:0 0 5px #4cafef; }

  /* Browser area */
  #browser { flex:1; overflow:auto; background:#fff; color:#000; padding:0; }

  a { color:#4cafef; text-decoration:underline; cursor:pointer; }

  /* Minimal hover effect */
  button:hover { filter: brightness(1.1); }
</style>
</head>
<body>

<header id="topbar">
  <button title="Fullscreen" onclick="toggleFullscreen()">‚õ∂</button>
  <button title="Back" onclick="goBack()">‚óÄ</button>
  <button title="Forward" onclick="goForward()">‚ñ∂</button>
  <button title="Refresh" onclick="refreshPage()">‚ü≥</button>
  <button title="Home" onclick="goHome()">üè†</button>
  <input id="url" type="text" placeholder="Enter URL or search term" onkeypress="handleEnter(event)">
  <button title="Go" onclick="navigate()">Go</button>
</header>

<div id="browser">Welcome to Euphoria!</div>

<script>
const browser = document.getElementById("browser");
const urlInput = document.getElementById("url");
const topbar = document.getElementById("topbar");
let historyStack = [];
let historyIndex = -1;
let fullscreen = false;

// Fullscreen toggle
function toggleFullscreen() {
    fullscreen = !fullscreen;
    topbar.classList.toggle('hidden', fullscreen);
}
document.addEventListener('keydown', e => { if(e.key === "Escape" && fullscreen) toggleFullscreen(); });

// URL normalization
function normalizeURL(input) {
    input = input.trim();
    if(!input) return "https://www.google.com";
    if(!/^https?:\/\//i.test(input)) {
        if(input.includes(".")) return "https://" + input;
        return `https://www.google.com/search?q=${encodeURIComponent(input)}`;
    }
    return input;
}

// Navigation functions
async function navigate() {
    let url = normalizeURL(urlInput.value);

    // Manage history
    if(historyIndex === -1 || historyStack[historyIndex] !== url) {
        historyStack = historyStack.slice(0, historyIndex + 1);
        historyStack.push(url);
        historyIndex++;
    }

    urlInput.value = url;
    browser.textContent = "Loading‚Ä¶";

    try {
        const res = await fetch(`/proxy?url=${encodeURIComponent(url)}`);
        const html = await res.text();
        browser.innerHTML = html;

        // Rewrite internal links to stay in proxy
        browser.querySelectorAll("a").forEach(a => {
            a.addEventListener("click", e => {
                e.preventDefault();
                urlInput.value = a.href;
                navigate();
            });
        });
    } catch(err) {
        browser.textContent = "Error loading page: " + err.message;
    }
}

function goBack() { if(historyIndex>0){ historyIndex--; urlInput.value=historyStack[historyIndex]; navigate(); } }
function goForward() { if(historyIndex<historyStack.length-1){ historyIndex++; urlInput.value=historyStack[historyIndex]; navigate(); } }
function refreshPage() { if(historyIndex>=0) navigate(); }
function goHome() { urlInput.value="https://www.google.com"; navigate(); }
function handleEnter(e) { if(e.key==="Enter") navigate(); }
</script>

</body>
</html>
