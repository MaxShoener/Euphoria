<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Euphoria Mini Browser</title>
<style>
  /* Base layout */
  html, body { margin:0; padding:0; height:100%; font-family: 'Segoe UI', sans-serif; background:#1e1e2f; color:#f0f0f0; display:flex; flex-direction:column; }
  #topbar { display:flex; align-items:center; gap:0.5rem; padding:0.5rem; background:#2e2e3e; transition:0.3s; }
  #topbar.hidden { display:none; }

  /* Input & buttons */
  input { flex:1; padding:0.5rem 0.75rem; border-radius:6px; border:none; background:#3e3e50; color:#f0f0f0; font-size:1rem; }
  input:focus { outline:none; box-shadow:0 0 5px #4cafef; }
  button { padding:0.5rem 1rem; border:none; border-radius:6px; background:#4cafef; color:white; cursor:pointer; transition:0.2s; font-weight:600; }
  button:hover { background:#3690d9; }

  /* Browser area */
  #browser { flex:1; overflow:auto; background:white; color:black; padding:1rem; }
  a { color:#4cafef; text-decoration:underline; cursor:pointer; }

  /* Responsive */
  @media(max-width:600px) { button { padding:0.4rem 0.6rem; font-size:0.9rem; } input { font-size:0.9rem; } }
</style>
</head>
<body>

<header id="topbar">
  <button onclick="toggleFullscreen()">‚õ∂</button>
  <button onclick="goBack()">‚óÄ</button>
  <button onclick="goForward()">‚ñ∂</button>
  <button onclick="refreshPage()">‚ü≥</button>
  <button onclick="goHome()">üè†</button>
  <input id="url" type="text" placeholder="Enter URL or search term" onkeypress="handleEnter(event)">
  <button onclick="navigate()">Go</button>
</header>

<div id="browser">Welcome to Euphoria! Enter a site above to browse.</div>

<script>
const browser = document.getElementById("browser");
const urlInput = document.getElementById("url");
let historyStack = [];
let historyIndex = -1;
let fullscreen = false;

function toggleFullscreen() {
    fullscreen = !fullscreen;
    document.getElementById('topbar').classList.toggle('hidden', fullscreen);
}

function normalizeURL(input) {
    input = input.trim();
    if(!input) return "https://www.google.com";
    if(!input.includes(".") && !input.startsWith("http")) {
        return `https://www.google.com/search?q=${encodeURIComponent(input)}`;
    }
    if(!/^https?:\/\//i.test(input)) input = "https://" + input;
    return input;
}

async function navigate() {
    let url = normalizeURL(urlInput.value);

    // Manage history
    if(historyIndex === -1 || historyStack[historyIndex] !== url) {
        historyStack = historyStack.slice(0, historyIndex + 1);
        historyStack.push(url);
        historyIndex++;
    }

    urlInput.value = url;
    browser.textContent = "Loading‚Ä¶";

    try {
        const res = await fetch(`/proxy?url=${encodeURIComponent(url)}`);
        const html = await res.text();
        browser.innerHTML = html;

        // Intercept internal links to stay in proxy
        browser.querySelectorAll("a").forEach(a => {
            a.addEventListener("click", e => {
                e.preventDefault();
                urlInput.value = a.href;
                navigate();
            });
        });

    } catch(err) {
        browser.textContent = "Error loading page: " + err.message;
    }
}

function goBack() {
    if(historyIndex > 0) {
        historyIndex--;
        urlInput.value = historyStack[historyIndex];
        navigate();
    }
}

function goForward() {
    if(historyIndex < historyStack.length - 1) {
        historyIndex++;
        urlInput.value = historyStack[historyIndex];
        navigate();
    }
}

function refreshPage() {
    if(historyIndex >= 0) navigate();
}

function goHome() {
    const home = "https://www.google.com";
    historyStack = historyStack.slice(0, historyIndex+1);
    historyStack.push(home);
    historyIndex++;
    urlInput.value = home;
    navigate();
}

function handleEnter(e) {
    if(e.key === "Enter") navigate();
}
</script>

</body>
</html>